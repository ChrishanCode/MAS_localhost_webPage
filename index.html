<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport" />
    <title>
        Sign In
    </title>
    <link href="css/app.css" rel="stylesheet" />
</head>

<body class="login-body">
    <main class="d-flex w-100">
        <div class="container d-flex flex-column">
            <div class="row vh-100">
                <div class="col-sm-10 col-md-8 col-lg-6 mx-auto d-table h-100">
                    <div class="d-table-cell align-middle">
                        <div class="text-center mt-4">
                            <h1 class="h2">
                                Welcome To,
                            </h1>
                            <p class="lead">
                                UTECH IoT Device Configuration system
                            </p>
                        </div>
                        <div class="card glass-card">
                            <div class="card-body">
                                <div class="m-sm-4">
                                    <div class="text-center"><img alt="Charles Hall" class="img-fluid" height="120"
                                            src="img/photos/hm.png" width="280" /></div>
                                    <form>
                                        <div class="mb-3"><label class="form-label">
                                                Username
                                            </label><input class="form-control form-control-lg glass-input"
                                                id="username" name="username" placeholder="Enter your Username"
                                                type="" /></div>
                                        <div class="mb-3 password-container"><label class="form-label">
                                                Password
                                            </label><input class="form-control form-control-lg glass-input"
                                                id="password" name="password" placeholder="Enter your password"
                                                type="password" /><span class="password-toggle"
                                                onclick="togglePasswordVisibility()"><i data-feather="eye"
                                                    id="toggler"></i></span></div>
                                        <div class="error-message" id="loginerror" style="padding-left: 5px;"></div>
                                        <div class="text-center mt-3"><a class="btn btn-lg btn-primary"
                                                onclick="handleSubmitLogin()">
                                                Sign in
                                            </a></div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        function togglePasswordVisibility() {
            var passwordInput = document.getElementById("password");
            var eyeIcon = document.getElementById("toggler");

            if (passwordInput.type === "password") {
                passwordInput.type = "text";
                eyeIcon.setAttribute("data-feather", "eye-off");
            } else {
                passwordInput.type = "password";
                eyeIcon.setAttribute("data-feather", "eye");
            }
            // Refresh Feather icons after changing attributes
            feather.replace();
        }

        function handleSubmitLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const loginerror = document.getElementById('loginerror');

            if (username == '' || password == '') {
                loginerror.textContent = "Please input credentials.";
                return;
            }
            const data = {
                username: username,
                password: password
            };
            const Jvalue = "&username=" + username + "&password=" + password;
            console.log(Jvalue);

            var xhr = new XMLHttpRequest();
            xhr.open("POST", "/login", true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded'); // application/x-www-form-urlencoded
            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        window.location.href = "/submit.html";
                    } else {
                        loginerror.textContent = "incorrect credentials.";
                        return;
                    }
                }
            };
            xhr.send(Jvalue);
        }


    </script>
</body>

</html>